<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NFL League Scores</title>

  <!-- Tailwind utilities -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Heading font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800&display=swap" rel="stylesheet">
  <link rel="preload" as="image" href="Assets/football-field.jpeg">

  <style>
  :root { --line: rgba(255,255,255,0.15); --theme:#2563eb; }

  /* ------------ Font ------------ */
  @font-face {
    font-family: 'Freshman';
    src: url('Assets/Freshman.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }

  /* ------------ Background ------------ */
  html, body { min-height: 100%; }
  body {
    font-family: 'Freshman', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:#fff;
    margin:0;
    background:#0b1220;
    letter-spacing: 0.03em;
  }

  body::before {
    content:"";
    position: fixed;
    inset: 0;
    z-index: -1;
    background:
      linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,.85)),
      url('Assets/football-field.jpeg');
    background-repeat: no-repeat;
    background-position: center top;
    background-size: cover;
  }

  @media (max-width: 640px){
    body::before{
      background-image:
        linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,.85)),
        url('Assets/football-field-mobile.jpeg'),
        url('Assets/football-field.jpeg');
      background-position: center 20%;
      background-size: cover;
    }
  }

  /* ------------ Rule highlights ------------ */
  .rule-key {
    color: #c8102e;   /* NFL red */
    font-weight: 700;
  }

  /* ------------ Typography ------------ */
  h1, h2, h3, h4, .riddle-title {
    font-family: 'Freshman', sans-serif;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 900;
  }
  .riddle-title { letter-spacing: 0.08em; }
  .text-2xl, .text-xl, .font-extrabold {
    font-family: 'Freshman', sans-serif;
    letter-spacing: 0.06em;
  }

  /* ------------ Helpers ------------ */
  .card { background: rgba(0,0,0,.50); border:1px solid var(--line); border-radius:1rem; box-shadow:0 4px 12px rgba(0,0,0,.5); }
  .tab-btn, .pill { background: rgba(255,255,255,.10); border:1px solid var(--line); color:#fff; transition:background .2s; font-family: 'Freshman', sans-serif; letter-spacing: 0.05em; text-transform: uppercase; }
  .tab-btn[aria-selected="true"]{ background: var(--theme); }
  .pill{ border-radius:.75rem; }
  .avatar{ width:56px; height:56px; border-radius:50%; object-fit:cover; }
  .grid-auto{ display:grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap:1rem; }

  /* ------------ Modals ------------ */
  .modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; z-index:50; }
  .modal-backdrop.open { display:flex; align-items:center; justify-content:center; }
  .modal-backdrop .card {
    background:#111; border:1px solid var(--line); border-radius:1rem;
    max-width:600px; padding:1.5rem; margin:1rem; box-shadow:0 8px 20px rgba(0,0,0,.6);
    font-family: 'Freshman', sans-serif; letter-spacing: 0.04em;
  }
  .close-x{
    position:absolute; top:.5rem; right:.75rem;
    width:2.25rem; height:2.25rem; line-height:2.25rem;
    text-align:center; border-radius:9999px;
    background:rgba(255,255,255,.08); border:1px solid var(--line);
    font-size:1.25rem; cursor:pointer;
  }
  .close-x:hover{ background:rgba(255,255,255,.15); }

  @media (max-width: 640px){
    header .riddle-title{ font-size:1.5rem }
    .card{ padding:1rem !important }
    .tab-btn, .pill{ font-size:1rem; padding:.5rem 1rem }
  }
  </style>
</head>
<body>
  <header class="max-w-xl mx-auto px-4 pt-6 pb-3">
    <div class="flex items-center justify-center">
      <img src="Assets/nfl-logo.png" alt="NFL" class="w-12 h-12 rounded-md shadow-lg">
    </div>
    <h1 class="riddle-title text-center font-extrabold mt-3"
        style="font-size:clamp(1.4rem, 4.8vw, 2rem); line-height:1.15;">
      NFL League
      <span class="block">Regular Season</span>
    </h1>
    <p class="text-center opacity-80 text-base mt-2">Updated weekly from JSON â€” simple to edit, zero build step.</p>
    <div class="mt-4 flex items-center justify-center gap-3">
      <button id="rulesBtn" class="tab-btn px-3 py-1.5 rounded-lg text-sm">Rules</button>
      <a id="repoLink" class="text-sm underline opacity-90 hover:opacity-100" target="_blank" rel="noreferrer">View on GitHub</a>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 sm:px-6 pb-24 space-y-6">
    <!-- Weekly Scores -->
    <section class="card p-5 sm:p-7">
      <div class="flex items-center justify-between">
        <h2 class="riddle-title text-2xl sm:text-3xl font-extrabold">Weekly Scores</h2>
        <div class="flex gap-2 items-center">
          <button id="totalBtn" class="tab-btn px-3 py-1.5 rounded-lg text-sm" aria-selected="true">Total</button>
          <select id="weekSelect" class="pill px-2 py-1 rounded-lg text-sm"></select>
        </div>
      </div>
      <div id="leaderboard" class="mt-5 grid-auto"></div>
    </section>

    <!-- Season Highlight -->
    <section class="card p-5 sm:p-7">
      <h3 class="riddle-title text-xl sm:text-2xl font-extrabold">Season Highlight</h3>
      <div id="highlight" class="mt-4 grid sm:grid-cols-2 gap-6"></div>
    </section>

    <!-- Honorary Winners -->
    <section class="card p-5 sm:p-7">
      <h3 class="riddle-title text-xl sm:text-2xl font-extrabold">Honorary Winners</h3>
      <ul id="honorary" class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></ul>
    </section>
  </main>

  <footer class="text-center text-sm opacity-75 py-6">
    <p>&copy; <span id="copyrightYear"></span> NFL League</p>
  </footer>

  <!-- Rules Modal -->
  <div id="rulesModal" class="modal-backdrop">
    <div class="card">
      <h3 class="riddle-title text-xl font-extrabold mb-3 text-center">League Rules</h3>
      <ol class="list-decimal pl-5 space-y-2 text-sm leading-6">
        <li><span class="rule-key">Submit</span> Sunday game picks before <span class="rule-key">6 PM UK</span>.</li>
        <li>Each correct prediction earns <span class="rule-key">1 point</span>.</li>
        <li><span class="rule-key">Perfect Week:</span> all Sunday games correct = <span class="rule-key">+2 bonus</span>.</li>
        <li><span class="rule-key">Specials:</span> Thanksgiving & International games score <span class="rule-key">double</span>.</li>
        <li>Ties are shared positions (<span class="rule-key">no tiebreaker</span>).</li>
      </ol>
      <div class="mt-4 text-right">
        <button id="closeRules" class="tab-btn px-3 py-1.5 rounded-lg text-sm">Close</button>
      </div>
    </div>
  </div>

  <!-- Player Profile Modal -->
  <div id="playerProfile" class="modal-backdrop">
    <div class="card relative max-w-xl w-[92vw]">
      <button id="closeProfile" class="close-x" aria-label="Close">Ã—</button>
      <div id="profileContent"></div>
    </div>
  </div>

<script>
function medal(rank){
  if(rank===0) return {emoji:"ðŸ¥‡", color:"from-yellow-400 to-yellow-600", name:"Gold"};
  if(rank===1) return {emoji:"ðŸ¥ˆ", color:"from-gray-300 to-gray-500", name:"Silver"};
  if(rank===2) return {emoji:"ðŸ¥‰", color:"from-amber-600 to-amber-800", name:"Bronze"};
  return null;
}

function compute({ players, weeks }){
  const playersById = Object.fromEntries(players.map(p=>[p.id,p]));
  const weekNums = [...new Set(weeks.map(w=>w.week))].sort((a,b)=>a-b);
  const totals = players.map(p=>({ id:p.id, name:p.name, avatar:p.avatar, total:0, perWeek:{} }));
  const idx = Object.fromEntries(totals.map(t=>[t.id,t]));
  weeks.forEach(w=>{
    const scores = w.scores || {};
    for(const [pid,pts] of Object.entries(scores)){
      const t = idx[pid]; if(!t) continue;
      const val = Number(pts)||0;
      t.total += val;
      t.perWeek[w.week] = val;
    }
  });
  return { playersById, totals, weekNums };
}

function playerCard(p, rank, view, selectedWeek){
  const m = medal(rank);
  let value = p.total, label = 'Total';
  if(view==='week'){ value = p.perWeek[selectedWeek]||0; label = `Week ${selectedWeek}`; }
  return `
    <article data-player-id="${p.id}" role="button" tabindex="0"
      class="relative rounded-2xl p-4 bg-black/70 border border-[var(--line)]
             transition duration-300 hover:-translate-y-[3px]
             hover:ring-4 hover:ring-amber-400/80 hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-amber-400/80">
      ${m ? `<div class="absolute -top-4 -right-3 bg-gradient-to-b ${m.color}
                       text-xl rounded-full w-12 h-12 grid place-items-center"
                 title="${m.name}">${m.emoji}</div>` : ''}
      <div class="flex items-center gap-3">
        <img src="${p.avatar}" alt="${p.name}" class="avatar border border-[var(--line)]"/>
        <div class="min-w-0">
          <div class="font-extrabold text-lg truncate">${p.name}</div>
        </div>
      </div>
      <div class="mt-3 grid text-center">
        <div class="rounded-xl border border-[var(--line)] py-3">
          <div class="text-xs opacity-80">${label}</div>
          <div class="text-2xl font-extrabold">${value}</div>
        </div>
      </div>
    </article>`;
}

function renderLeaderboard(totals, view, selectedWeek){
  const sorted = [...totals].sort((a,b)=>{
    if(view==='week') return (b.perWeek[selectedWeek]||0) - (a.perWeek[selectedWeek]||0);
    return b.total - a.total;
  });
  document.getElementById('leaderboard').innerHTML =
    sorted.map((p,i)=>playerCard(p,i,view,selectedWeek)).join('');
  wireCardClicks();
}

function renderHighlight(cfg, playersById){ /* unchanged */ }
function renderHonorary(cfg, playersById){ /* unchanged */ }

// ---- Profile helpers ----
function longestScoringStreak(perWeek, weekNums){
  let best=0,cur=0,prev=null;
  for(const w of weekNums){
    const v=perWeek[w]||0;
    if(v>0){ if(prev!==null&&w===prev+1){cur++}else{cur=1}; best=Math.max(best,cur); }
    else cur=0; prev=w;
  }
  return best;
}
function showPlayerProfile(pid){
  const modal=document.getElementById('playerProfile');
  const content=document.getElementById('profileContent');
  if(!window.state) return;
  const p=state.totals.find(t=>t.id===pid); if(!p) return;
  const weeks=state.weekNums;
  const entries=weeks.map(w=>({week:w,pts:(p.perWeek[w]||0)}));
  const gamesPlayed=entries.filter(e=>p.perWeek[e.week]!==undefined).length;
  const total=p.total; const avg=gamesPlayed?(total/gamesPlayed).toFixed(2):'0.00';
  const best=entries.reduce((acc,e)=> e.pts>acc.pts?e:acc,{week:null,pts:-Infinity});
  const streak=longestScoringStreak(p.perWeek,weeks);
  const weeksRows=entries.map(e=>`<tr><td class="px-3 py-1.5 border-b border-[var(--line)]">Week ${e.week}</td><td class="px-3 py-1.5 border-b border-[var(--line)] text-right">${e.pts}</td></tr>`).join('');
  content.innerHTML=`
    <div class="flex items-center gap-3 mb-3">
      <img src="${p.avatar}" class="w-14 h-14 rounded-full border border-[var(--line)]">
      <div><div class="text-xl font-extrabold">${p.name}</div><div class="opacity-80 text-sm">Player profile</div></div>
    </div>
    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4">
      <div class="card p-3 text-center"><div class="text-xs opacity-80">Total Points</div><div class="text-2xl font-extrabold">${total}</div></div>
      <div class="card p-3 text-center"><div class="text-xs opacity-80">Games Played</div><div class="text-2xl font-extrabold">${gamesPlayed}</div></div>
      <div class="card p-3 text-center"><div class="text-xs opacity-80">Avg / Game</div><div class="text-2xl font-extrabold">${avg}</div></div>
      <div class="card p-3 text-center"><div class="text-xs opacity-80">Best Week</div><div class="text-lg font-extrabold">${best.week===null?'â€”':`W${best.week}: ${best.pts}`}</div></div>
      <div class="card p-3 text-center col-span-2 sm:col-span-4"><div class="text-xs opacity-80">Longest Scoring Streak</div><div class="text-xl font-extrabold">${streak} ${streak===1?'week':'weeks'}</div></div>
    </div>
    <div class="card overflow-hidden"><table class="w-full text-sm"><thead class="bg-white/5"><tr><th class="text-left px-3 py-2">Week</th><th class="text-right px-3 py-2">Points</th></tr></thead><tbody>${weeksRows}</tbody></table></div>`;
  modal.classList.add('open');
}
function wireCardClicks(){
  const profileModal=document.getElementById('playerProfile');
  document.querySelectorAll('[data-player-id]').forEach(el=>{
    const id=el.getAttribute('data-player-id');
    el.addEventListener('click',()=>showPlayerProfile(id));
    el.addEventListener('keydown',e=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();showPlayerProfile(id)}});
  });
  document.addEventListener('keydown',e=>{if(e.key==='Escape') profileModal.classList.remove('open');});
}

// ---- Data I/O ----
async function loadJSON(path){ const res=await fetch(path,{cache:'no-store'}); if(!res.ok) throw new Error("Failed to load "+path); return await res.json(); }
const paths={players:"players.json",weeks:"weeks.json",config:"config.json"};

// ---- Boot ----
(async function boot(){
  try{
    const [players,weeks,config]=await Promise.all([loadJSON(paths.players),loadJSON(paths.weeks),loadJSON(paths.config)]);
    const {playersById,totals,weekNums}=compute({players,weeks}); window.state={playersById,totals,weekNums};
    // Dropdown
    const sel=document.getElementById('weekSelect');
    sel.innerHTML=weekNums.map(w=>`<option value="${w}">Week ${w}</option>`).join('');
    sel.insertAdjacentHTML('afterbegin','<option value="all" selected>All</option>');
    sel.addEventListener('change',()=>{const val=sel.value; if(val==='all'){renderLeaderboard(totals,'total')}else{renderLeaderboard(totals,'week',Number(val))}});
    document.getElementById('totalBtn').addEventListener('click',()=>{sel.value='all';renderLeaderboard(totals,'total')});
    // Default view
    sel.value='all'; renderLeaderboard(totals,'total');
    renderHighlight(config,playersById); renderHonorary(config,playersById);
    // Rules
    const rulesModal=document.getElementById('rulesModal'); const rulesBtn=document.getElementById('rulesBtn'); const closeRules=document.getElementById('closeRules');
    rulesBtn.addEventListener('click',()=>rulesModal.classList.add('open')); closeRules.addEventListener('click',()=>rulesModal.classList.remove('open')); rulesModal.addEventListener('click',e=>{if(e.target===rulesModal) rulesModal.classList.remove('open')});
    // Player Profile
    const profileModal=document.getElementById('playerProfile'); document.getElementById('closeProfile').addEventListener('click',()=>profileModal.classList.remove('open')); profileModal.addEventListener('click',e=>{if(e.target===profileModal) profileModal.classList.remove('open')});
    // Footer
    document.getElementById('copyrightYear').textContent=new Date().getFullYear();
    if(config.repo) document.getElementById('repoLink').href=config.repo;
  }catch(err){ console.error("Init failed",err); document.getElementById('leaderboard').innerHTML="<p class='text-red-400'>Failed to load data.</p>"; }
})();
</script>
</body>
</html>
